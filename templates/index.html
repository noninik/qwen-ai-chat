<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI –ß–∞—Ç ‚Äî Qwen3</title>
    <link rel="stylesheet" href="/static/style.css">
    <!-- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–æ–¥–∞ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>
    <!-- –°–∞–π–¥–±–∞—Ä —Å —á–∞—Ç–∞–º–∏ -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3>üí¨ –ß–∞—Ç—ã</h3>
            <button class="sidebar-close" onclick="toggleSidebar()">‚úï</button>
        </div>
        <a href="/new" class="new-chat-sidebar-btn">+ –ù–æ–≤—ã–π —á–∞—Ç</a>
        <div class="chat-list">
            {% if chat_list %}
                {% for chat in chat_list %}
                <a href="/chat/{{ chat.id }}" class="chat-item {% if current_chat_id == chat.id %}active{% endif %}">
                    <span class="chat-title">{{ chat.title }}</span>
                    <a href="/delete/{{ chat.id }}" class="delete-btn" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —á–∞—Ç?')">üóëÔ∏è</a>
                </a>
                {% endfor %}
            {% else %}
                <p class="no-chats">–ü–æ–∫–∞ –Ω–µ—Ç —á–∞—Ç–æ–≤</p>
            {% endif %}
        </div>
        <div class="token-counter">
            <span>üìä –¢–æ–∫–µ–Ω—ã: ~{{ token_count }}</span>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="container">
        <header>
            <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
            <div class="header-center">
                <h1>ü§ñ AI –ß–∞—Ç</h1>
                <p class="subtitle">Powered by Qwen3-Coder</p>
            </div>
            <div class="header-actions">
                <button class="theme-btn" onclick="toggleTheme()" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">üåô</button>
                <a href="/clear/{{ session_id }}" class="clear-btn" title="–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç">üóëÔ∏è</a>
                <a href="/export/{{ session_id }}" class="export-btn" title="–°–∫–∞—á–∞—Ç—å —á–∞—Ç">üì•</a>
            </div>
        </header>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–º–æ–¥–µ–ª—å + —Ä–æ–ª—å) -->
        <div class="settings-bar">
            <div class="setting">
                <label>üß† –ú–æ–¥–µ–ª—å:</label>
                <select id="modelSelect" form="chatForm" name="model_name">
                    {% for name in models %}
                    <option value="{{ name }}" {% if name == selected_model %}selected{% endif %}>{{ name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="setting">
                <label>üé≠ –†–æ–ª—å:</label>
                <select id="roleSelect" form="chatForm" name="role_name">
                    {% for name in roles %}
                    <option value="{{ name }}" {% if name == selected_role %}selected{% endif %}>{{ name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- –û–∫–Ω–æ —á–∞—Ç–∞ -->
        <div class="chat-box" id="chatBox">
            {% if messages %}
                {% for msg in messages %}
                    {% if msg.role == "user" %}
                    <div class="message user-msg">
                        <div class="avatar">üë§</div>
                        <div class="bubble">{{ msg.content }}</div>
                    </div>
                    {% elif msg.role == "assistant" %}
                    <div class="message bot-msg">
                        <div class="avatar">ü§ñ</div>
                        <div class="bubble">
                            <div class="markdown-content">{{ msg.html | safe }}</div>
                            <button class="copy-btn" onclick="copyMessage(this)" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å">üìã</button>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            {% else %}
                <div class="welcome">
                    <h2>üëã –ü—Ä–∏–≤–µ—Ç!</h2>
                    <p>–í—ã–±–µ—Ä–∏ –º–æ–¥–µ–ª—å –∏ —Ä–æ–ª—å —Å–≤–µ—Ä—Ö—É, –∑–∞—Ç–µ–º –∑–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å!</p>
                    <div class="suggestions">
                        <button onclick="fillQuestion('–ù–∞–ø–∏—à–∏ –∫–æ–¥ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –Ω–∞ Python')">
                            üíª –ù–∞–ø–∏—à–∏ –∫–æ–¥ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
                        </button>
                        <button onclick="fillQuestion('–û–±—ä—è—Å–Ω–∏ —á—Ç–æ —Ç–∞–∫–æ–µ API –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏')">
                            üìñ –ß—Ç–æ —Ç–∞–∫–æ–µ API?
                        </button>
                        <button onclick="fillQuestion('–ü—Ä–∏–¥—É–º–∞–π –∏–¥–µ—é –¥–ª—è —Å—Ç–∞—Ä—Ç–∞–ø–∞')">
                            üöÄ –ò–¥–µ—è –¥–ª—è —Å—Ç–∞—Ä—Ç–∞–ø–∞
                        </button>
                        <button onclick="fillQuestion('–ü–µ—Ä–µ–≤–µ–¥–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π: –ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?')">
                            üåê –ü–µ—Ä–µ–≤–µ–¥–∏ —Ç–µ–∫—Å—Ç
                        </button>
                        <button onclick="fillQuestion('–ù–∞–ø–∏—à–∏ —Å–º–µ—à–Ω—É—é —à—É—Ç–∫—É –ø—Ä–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤')">
                            üòÑ –†–∞—Å—Å–∫–∞–∂–∏ —à—É—Ç–∫—É
                        </button>
                        <button onclick="fillQuestion('–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã —É–¥–∞–ª—ë–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã')">
                            üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
                        </button>
                    </div>
                </div>
            {% endif %}
        </div>

        <!-- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ -->
        <form action="/chat" method="post" class="input-form" id="chatForm" onsubmit="showLoading()">
            <input type="hidden" name="session_id" value="{{ session_id }}">
            <input
                type="text"
                name="user_message"
                id="userInput"
                placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..."
                autocomplete="off"
                required
            >
            <button type="submit" id="sendBtn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M2 21L23 12L2 3V10L17 12L2 14V21Z" fill="white"/>
                </svg>
            </button>
        </form>

        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div class="loading" id="loading" style="display: none;">
            <div class="loading-dots">
                <span>ü§ñ –î—É–º–∞—é</span>
                <div class="dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="copy-toast" id="copyToast">‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!</div>

    <script src="/static/script.js"></script>
</body>
</html>
